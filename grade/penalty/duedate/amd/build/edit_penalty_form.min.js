define("gradepenalty_duedate/edit_penalty_form",["exports","core/notification","core/fragment","core/templates"],(function(_exports,notification,_fragment,_templates){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _getRequireWildcardCache(nodeInterop){if("function"!=typeof WeakMap)return null;var cacheBabelInterop=new WeakMap,cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,notification=function(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule)return obj;if(null===obj||"object"!=typeof obj&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if("default"!==key&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}newObj.default=obj,cache&&cache.set(obj,newObj);return newObj}
/**
   * Handles edit penalty form.
   *
   * @module     gradepenalty_duedate/edit_penalty_form
   * @copyright  2024 Catalyst IT
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */(notification),_fragment=_interopRequireDefault(_fragment),_templates=_interopRequireDefault(_templates);class PenaltyRule{constructor(){this.overdueby=0,this.penalty=0}}const SELECTORS_FORM_CONTAINER="#penalty_rule_form_container",SELECTORS_ACTION_MENU=".action-menu",SELECTORS_ADD_BUTTON="#addrulebutton",SELECTORS_INSERT_BUTTON=".insertbelow",SELECTORS_DELETE_BUTTON=".deleterulebuttons",deleteRule=target=>{let params=buildFormParams(),rulenumber=target.dataset.rulenumber;void 0===rulenumber&&(rulenumber=target.parentElement.dataset.rulenumber),rulenumber=parseInt(rulenumber);let penaltyRules=JSON.parse(params.penaltyrules);penaltyRules.splice(rulenumber,1),penaltyRules=JSON.stringify(penaltyRules),params.penaltyrules=penaltyRules,loadPenaltyRuleForm(params.contextid,params)},insertRule=target=>{let params=buildFormParams(),rulenumber=target.dataset.rulenumber;void 0===rulenumber&&(rulenumber=target.parentElement.dataset.rulenumber),rulenumber=parseInt(rulenumber);let penaltyRule=new PenaltyRule,penaltyRules=JSON.parse(params.penaltyrules);penaltyRules.splice(rulenumber+1,0,penaltyRule),penaltyRules=JSON.stringify(penaltyRules),params.penaltyrules=penaltyRules,loadPenaltyRuleForm(params.contextid,params)},addRule=()=>{let params=buildFormParams(),penaltyRule=new PenaltyRule,penaltyRules=JSON.parse(params.penaltyrules);penaltyRules.push(penaltyRule),penaltyRules=JSON.stringify(penaltyRules),params.penaltyrules=penaltyRules,loadPenaltyRuleForm(params.contextid,params)},buildFormParams=()=>{let form=document.querySelector(SELECTORS_FORM_CONTAINER).querySelector("form"),formData=new FormData(form),contextid=formData.get("contextid"),groupCount=formData.get("rulegroupcount"),penaltyRules=[];for(let i=0;i<groupCount;i++){let penaltyRule=new PenaltyRule;penaltyRule.overdueby=formData.get("overdueby[".concat(i,"][number]"))*formData.get("overdueby[".concat(i,"][timeunit]")),penaltyRule.penalty=formData.get("penalty[".concat(i,"]")),penaltyRules.push(penaltyRule)}return{contextid:contextid,penaltyrules:JSON.stringify(penaltyRules),finalpenaltyrule:formData.get("finalpenaltyrule")}},loadPenaltyRuleForm=(contextid,params)=>{_fragment.default.loadFragment("gradepenalty_duedate","penalty_rule_form",contextid,params).done(((html,js)=>{let formContainer=document.querySelector(SELECTORS_FORM_CONTAINER);_templates.default.replaceNodeContents(formContainer,html,js)})).fail(notification.exception)};_exports.init=()=>{(()=>{const actionMenus=document.querySelector(SELECTORS_FORM_CONTAINER).querySelectorAll(SELECTORS_ACTION_MENU);let rulenumber=0;actionMenus.forEach((actionMenu=>{const deleteButton=actionMenu.querySelector(SELECTORS_DELETE_BUTTON),insertButton=actionMenu.querySelector(SELECTORS_INSERT_BUTTON);deleteButton.dataset.rulenumber=rulenumber,deleteButton.addEventListener("click",(e=>{e.preventDefault(),deleteRule(e.target)})),insertButton.dataset.rulenumber=rulenumber,insertButton.addEventListener("click",(e=>{e.preventDefault(),insertRule(e.target)})),rulenumber++})),document.querySelector(SELECTORS_ADD_BUTTON).addEventListener("click",(e=>{e.preventDefault(),addRule()}))})()}}));

//# sourceMappingURL=edit_penalty_form.min.js.map